#### 与 HTTP 有关的组件

##### 网络模型--五层网络协议

为了给网络协议的设计提供一个结构， 网络设计者以分层的方式组织协议，每个协议属于层次模型之一，每一层都是向它的上一级提供服务，即所谓的服务模型； 每个分层中所有的协议称为  **协议栈**；

**协议栈**由 5 个部分组成：即 五层网络协议

* 应用层----确定向用户提供的应用服务时的通信活动使用何种协议； 比如：HTTP 、DNS、FTP、SMTP 等；一旦从应用程序来的数据被编码成一个标准的应用层协议，它将被传送到IP栈的下一层。

> 是应用程序和网络协议存放的分层；因特网的应用层有许多的协议： 比如： HTTP，邮件传送协议 SMTP,解析域名的 DNS 协议等； 应用层分布在多个端系统上，一个端系统应用程序与另外一个端系统应用程序交换信息分组，这样的信息分组称为 **报文**；

* 传输层-----传送应用程序的报文

> 运输层 在应用程序断点之间传送应用程序的报文，在这一层主要有两种传输协议 **TCP** 和**UDP**
>
> **TCP**-传输控制协议：向它的应用程序提供了面向连接的服务，它能控制并确认报文是否到达，并提供了拥塞机制来控制网络传输，因此当网络拥塞时，会抑制其传输速率；
>
> **UDP**-用户数据协议：向它的应用程序提供了无连接服务，它不具备可靠性的特征，没有流量控制，也没有拥塞控制，我们把运输层的分组 称为**报文段**；

* 网络层----用于约定发送位置的 IP 协议； 用来处理流动的数据包； 也被称为 IP 层； 核心： 地址和路由；

> 负责将数据报的网络分层从一台主机移动到另外一台主机，网络层有一个非常重要的协议就是IP 协议；
>
> 在网络层 除了 IP 协议外，还包括一些其他网际协议 和路由选择协议，一般把网络层称为 IP 层； 

* 链路层----用来处理连接网络的硬件部分

> 为了将分组从一个节点运输到另外一个节点，网络层必须依靠链路层提供服务；
>
> 链路层 包括：以太网、WIFI、和电缆接入的 DOCSIS 协议，数据从源目的地传送需要经过几条链路，一个数据包可能被沿途不同的链路层协议处理，我们把链路层的分组，叫做 帧（frame）
>
> 

* 物理层

> 链路层的作用是将帧从一个端系统运输到另一个端系统，而物理层的作用是将帧中的一个个比特从一个节点运输到另外一个节点；物理层的协议仍然使用链路层协议，这些协议实际与物理传输介质 有关； 
>
> 比如，以太网有很多的物理层协议： 关于同轴电缆，关于光纤等

#### OSI 模型

相比于五层网络协议 OSI模型 有七层； 也被称为七层网络模型； 

应用层----->  （表示层--------->会话层）-------> 传输层 --------> 网络层 -----------> 链路层 ----------->  物理层

从上可以看出；相比于五层网络模型， 7 层网络模型，在应用层后，增加了 表示层 和会话层； 

*  表示层 

> 主要包括数据压缩 和数据加密以及数据描述， 数据描述使得应用程序不必担心计算机内部存储格式的问题

* 会话层

> 提供了数据交换的定界和同步功能，包括建立检查点和恢复方案；

 为什么要进行分层？

* 假如互联网只有一个协议统筹，某个地方改变设计的时候 ， 就需要把所有的地方都替换掉， 而分层只需要把变动的层替换掉就可以了； 而且分层管理，设计也相对简单，处于应用层的应用值需要考虑分派自己的任务 而不需要考虑对方的传输线路是怎样的，能否传输送达；

#### TCP  / UDP 

TCP 协议提供面向链接、字节流 和可靠的传输；

在使用 TCP 协议进行通信的双方 必须先建立链接，然后 才可以开始传输数据；

##### UDP

概念：用户数据报（ 是与分组交换网络关联的传输单元）协议；不需要所谓的握手操作，从而加快了通信速度，允许网络上的其他主机在接收方同意通信之前进行数据传输；

特点：

* UDP 能够支持容忍数据包丢失的宽带密集型应用程序
* UDP 具有低延迟的特点
* UDP 能发送大量的数据包
* UDP能够允许 DNS 查找，DNS 是建立在 UDP 之上的应用层协议；

##### TCP

概念：传输控制协议； 能够帮助你确定计算机连接到 Internet 以及他们之间的数据传输，通过三次握手来建立 TCP 链接， 三次握手就是用来启动和确认 TCP 连接的过程， 一旦链接 建立后，就可以发送数据了，当传输完成后，会通过关闭虚拟电路来断开电缆； 

特点：

* TCP 能够确保连接的建立 和数据的发送；
* TCP 支持错误重传机制
* TCP 机制拥塞控制，能够在网络拥堵的情况下延迟发送
* TCP 能后提供错误检验和，甄别有害的数据包；

##### TCP 和 UDP 的区别

区别： 

* TCP 是面向链接的协议， UDP 是无链接协议；
* TCP 在发送数据前 需要先建立链接，在发送数据；UDP 无需建立，就可以直接发送大量的数据；
* TCP 会按照特定顺序重新排列数据包，UDP 数据包， 没有固定顺序，所有的数据包都可以相互独立；
* TCP 传输速度比较的慢，UDP 传输速度比较的快； 
* TCP 头部字节 开销最下 20 字节最大 60 字节， UDP 头部开销小，只需要 8 字节；
* TCP是重量级的， 在发送任何数据前，TCP 都需要建立三次握手以此建立链接； TCP 是轻量级的， 没有链接 ，和消息排序等； 
* TCP 会进行错误检验，并能够进行错误恢复；UDP也会检查错误，但是会丢弃错误的数据包
* TCP 有发送确认， UDP 没有发送确认；
* TCP会使用握手协议 ， 比如：SYN,ACK 等； UDP 无握手协议； 
* TCP 是可靠的， 能够确保将数据传送到路由器， UDP 不能保证；
* TCP连接对象个数可以是：只能是 一对一； UDP 是  一对一，一对多，多对多交互通信；
* TCP 传输方式是面向字节流，UDP 是面向报文；
* TCP 适用于稳定可靠的应用，比如文件传输，UDP 适用于实时应用（IP电话、视频会议、直播会议等）

#### TCP的三次握手 和四次挥手



**进行三次握手的主要作用是**： 为了确认双方的接收能力和发送能力是否正常、指定自己的初始化序列号为后面的可靠性传送做准备； 



三次握手，先了解几个概念；

* SYN： 同步序列号；是 TCP/IP 建立连接使用的握手信号， 在建立连接的时候，首先发送一个信号
* SYN—ACK： 服务器在接收到 SYN 后，打开客户端连接，发送一个 SYN-ACK 作为答复
* ACK： 确认字符， 表示自己发来的数据已经确认接收无误；

三次握手切实就是指建立一个 TCP 连接时，需要客户端和服务器总共发送 3 个包；

刚开始客户端处于 Closed 状态， 服务端处于 Listen 状态， 进行三次握手： 

* 第一次握手： 客户端给服务端发送一个SYN报文 ， 并指明客户端的初始化序列号 ISN，此时客户端处于 SYN_SEND状态； 
* 第二次握手： 服务端接收到客户端的 SYN报文后，会以自己的 SYN 报文作为应答，并且也指定自己的一个初始化系列号 ISN，同时把客户端的过来的 ISN+ 1作为 ACK 值，表示自己已经收到了 客户端的 SYN，此时服务器处于 SYN_REVD 状态；
* 第三次握手： 客户端收到 SYN 报文后， 会先发送一个 ACK 报文，当然，也是一样把服务器 ISN +1 作为 ACK 的值，表示已经收到了服务端的 SYN 报文，此时客户端处于ESTABLISHED 状态。 服务端收到 ACK 报文后， 也处于ESTABLISHED 状态， 此时双方建立了连接；

##### 为什么需要三次握手，两次不行吗？

* 第一次握手：客户端发送网络包，服务端收到了。得出结论： 客户端的发送能力、服务端的接收能力都是正常的； 
* 第二次握手： 服务端发包，客户端接收到了。得出结论： 服务端的接收、发送能力，客户端的接收、发送能力是正常的； 不过此时服务器并不能确认客户端的接收能力是否正常； 
* 第三次握手： 客户端发包，服务端接收到了。得出结论： 客户端的接收、发送能力正常，服务器自己的发送、接收能力也正常。

所以，需要三次握手才能确认双方的接收和发送能力是否正常；

如果 两次握手，会发生什么？

> 第二次握手结束瘦， 服务端不知道客户端的接受能力是否正常， 以为没有第三次握手 给服务端反馈，所以 就可能出现超时，出现服务端重新给客户端发送报文。造成不必要的浪费



##### 什么是半连接队列？

服务器在第一次收到客户端的 SYN之后 ， 就会处于 SYN_RCVD 状态，此时双方 还没有完全建立其连接，服务器会把此种状态下请求连接放到一个队列里， 我们把这种队列叫做 半连接队列；

完成三次握手后，就是全连接队列；建立起的队列就会放在全连接中，如果队列满了，就会出现丢包的现象；

##### ISN(Initial Sequence Number)是固定的吗

**SYN-ACK 重传次数**的问题： 服务器发送完SYN-ACK包，如果未收到客户确认包，服务器进行首次重传，等待一段时间仍未收到客户确认包，进行第二次重传。如果重传次数超过系统规定的最大重传次数，系统将该连接信息从半连接队列中删除。 注意，每次重传等待的时间不一定相同，一般会是指数增长，例如间隔时间为 1s，2s，4s，8s......

ISN可以看作是一个32比特的计数器，每4ms加1

**三次握手的其中一个重要功能是客户端和服务端交换 ISN(Initial Sequence Number)，以便让对方知道接下来接收数据的时候如何按序列号组装数据。如果 ISN 是固定的，攻击者很容易猜出后续的确认号，因此 ISN 是动态生成的**

#####  三次握手 可以携带数据吗？

第一次握手和第二次握手不能携带数据，容易让攻击者在 SYN 报文中存放大量的数据，因为攻击者更本不管服务器的发送、接受能力是否正常。 会发送大量的数据 ； 

对于第三次握手，此时客户端处于ESTABLISHED（确定状态）了，已经建立其连接了， 也知道服务端的接收、发送能力是正常的了；



##### SYN 攻击是什么？

